apiVersion: ray.io/v1alpha1
kind: RayCluster
metadata:
  name: raycluster-mini
  namespace: default
spec:
  enableInTreeAutoscaling: true
  headGroupSpec:
    rayStartParams:
      block: "true"
      dashboard-host: 0.0.0.0
      num-cpus: "1"
    serviceType: ClusterIP
    template:
      spec:
        containers:
        - image: rayproject/ray:2.2.0
          name: ray-head
          ports:
          - containerPort: 6379
            name: gcs-server
            protocol: TCP
          - containerPort: 8265
            name: dashboard
            protocol: TCP
          - containerPort: 10001
            name: client
            protocol: TCP
          resources:
            limits:
              cpu: 1
              memory: 1Gi
            requests:
              cpu: 500m
              memory: 1Gi
          volumeMounts:
            - mountPath: /var/log
              name: log-volume
        volumes:
          - name: log-volume
            emptyDir: {}
  workerGroupSpecs:
    # the pod replicas in this group typed worker
    - groupName: cpu-group
      replicas: 0
      minReplicas: 0
      maxReplicas: 15
      rayStartParams:
        node-ip-address: $MY_POD_IP
        block: "true"
        num-gpus: '0'
      #pod template
      template:
        spec:
          runtimeClassName: selinux
          containers:
            - name: ray # must consist of lower case alphanumeric characters or '-', and must start and end with an alphanumeric character (e.g. 'my-name',  or '123-abc'
              # All Ray pods in the RayCluster should use the same version of Ray.
              image: rayproject/ray:2.2.0
              ports:
                - containerPort: 80
              lifecycle:
                preStop:
                  exec:
                    command: ["/bin/sh", "-c", "ray stop"]
              resources:
                limits:
                  cpu: 1
                  memory: 1Gi
                requests:
                  cpu: 500m
                  memory: 1Gi

  rayVersion: 2.2.0
